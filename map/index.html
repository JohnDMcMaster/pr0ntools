<html>
<head>
<title>Custom Google Map API V3</title>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0; padding: 0 }
  #si_canvas { height: 100% }
</style>

</head>
<body>

<div id="si_canvas"></div>

<script>

var options = {
  scrollwheel: false,
  scaleControl: true,
  mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU}
}

var SI_RANGE_X = 5672;
var SI_RANGE_Y = 4373;

function SiProjection() {
  // Using the base map tile, denote the lat/lon of the equatorial origin.
  this.worldOrigin_ = new google.maps.Point(SI_RANGE_X / 2, SI_RANGE_Y / 2);

  // This projection has equidistant meridians, so each longitude
  // degree is a linear mapping.
  this.worldCoordinatePerLonDegree_ = SI_RANGE_X / 360;
  this.worldCoordinatePerLatDegree_ = SI_RANGE_Y / 360;
};

firstL = false
//firstL = true
SiProjection.prototype.fromLatLngToPoint = function(latLng) {
	var origin = this.worldOrigin_;
	var x = origin.x + this.worldCoordinatePerLonDegree_ * latLng.lng();
	var y = origin.y + this.worldCoordinatePerLatDegree_ * latLng.lat();
	if (firstL) {
		firstL = false;
		alert('(lng ' + latLng.lng() + ', lat ' + latLng.lat() + ') => (x ' + x + ', y ' + y + ')')
	}
	return new google.maps.Point(x, y);
};

SiProjection.prototype.fromPointToLatLng = function(point, noWrap) {
  var y = point.y;
  var x = point.x;

  if (y < 0) {
    y = 0;
  }
  if (y >= SI_RANGE_Y) {
    y = SI_RANGE_Y;
  }
  if (x < 0) {
    x = 0;
  }
  if (x >= SI_RANGE_X) {
    x = SI_RANGE_X;
  }
  
if (firstL) {
	firstL = false;
	alert('(x ' + x + ', y ' + y + ') => (lng ' + latLng.lng() + ', lat ' + latLng.lat() + ')')
}

  var origin = this.worldOrigin_;
  var lng = (x - origin.x) / this.worldCoordinatePerLonDegree_;
  var lat = (y - origin.y) / this.worldCoordinatePerLatDegree_;
  return new google.maps.LatLng(lat, lng, noWrap);
};


var siMap = new google.maps.Map(document.getElementById("si_canvas"), options);
siMap.setCenter(new google.maps.LatLng(1, 1));
siMap.setZoom(1);

first = false
//first = true;
var mos6522NoMetal = new google.maps.ImageMapType({
  getTileUrl: function(ll, z) {
  	//TODO: consider not 0 padding if this is going to be a performance issue
  	//it does make organizing them easier though
    var r = "http://localhost/map/tiles_out/y" + String("00" + ll.y).slice(-3) + "_x" + String("00" + ll.x).slice(-3) + ".png"; 
    //var r = "http://localhost/map/tiles_out/y00" + ll.y + "_x00" + ll.x + ".png"; 
	if (first) {
	    first = false;
	    alert(r);
    }
    return r;
  },
  tileSize: new google.maps.Size(256, 256),
  isPng: true,
  maxZoom: 0,
  name: "SM",
  alt: "6522 w/o metal"
});
mos6522NoMetal.projection = new SiProjection();


siMap.mapTypes.set('mos6522', mos6522NoMetal);
siMap.setMapTypeId('mos6522');

siMap.setOptions({
  mapTypeControlOptions: {
    mapTypeIds: [
      'mos6522'
    ],
    style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
  }
});


</script>

</body>
</html>

